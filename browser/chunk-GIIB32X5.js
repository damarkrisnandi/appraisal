import{a as K,b as J}from"./chunk-WJBKFWRX.js";import{a as H,b as w}from"./chunk-D2DQFAJA.js";import{C as z,g as $e,l as De,u as Re,v as xe,w as Fe,y as Me}from"./chunk-IASCCSKW.js";import"./chunk-ZY2XEEFJ.js";import{b as Ue,c as we}from"./chunk-ID5XGVUQ.js";import{l as D,m as N}from"./chunk-3N6CWGCP.js";import"./chunk-4YRY4IP2.js";import"./chunk-CKH6MXIN.js";import"./chunk-ZM3QWDCU.js";import"./chunk-VP5IOBEZ.js";import{a as q}from"./chunk-OQKDZ6KP.js";import{a as ve,c as j,f as A,g as B,h as U,i as h,k as O,l as V,p as G}from"./chunk-CXEROHL4.js";import{a as Ce}from"./chunk-XYMFY6KF.js";import{oa as Se,va as _e,wa as R}from"./chunk-GJCIPXRX.js";import{Dc as be,G as ie,Gb as ee,H as se,Hb as S,I as ae,Jb as te,Ka as de,Kc as ye,O as ne,Oa as n,Ob as E,Pb as y,Qb as ge,U as le,W as ce,Xa as a,Z as M,a as _,ac as P,b as v,bb as I,ca as C,da as u,db as pe,eb as c,ha as b,ib as k,jb as me,kb as ue,mb as fe,mc as $,nb as he,ob as i,pb as s,qb as p,ra as L,sa as T,ub as W,v as Z,vb as f,wb as d}from"./chunk-5OT5OU7P.js";var x=class o{userStore=u(m);ref=u(H);userForm=new U({username:new h({value:null,disabled:!0}),role:new h({value:null,disabled:!0})});roleOptions=[];selectedDataSubscription;formModeSubscribtion;constructor(){this.selectedDataSubscription=R(this.userStore.$selectedData).subscribe(e=>{this.userForm.patchValue({username:this.userStore.$selectedData()?.userName,role:this.userStore.$selectedData()?.roleId})}),this.formModeSubscribtion=R(this.userStore.$formMode).subscribe(e=>{switch(e){case"add":this.userForm.get("username")?.enable(),this.userForm.get("role")?.enable();break;case"edit":this.userForm.get("username")?.disable(),this.userForm.get("role")?.enable();break;case"idle":this.userForm.get("username")?.disable(),this.userForm.get("role")?.disable();break;default:break}})}cancel(){this.ref.close()}save(){console.log(this.userForm),this.userStore.saveAction(this.userForm.value)?.subscribe(e=>{e.status&&this.ref.close()})}ngOnDestroy(){this.userForm.reset(),this.selectedDataSubscription.unsubscribe(),this.formModeSubscribtion.unsubscribe()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=b({type:o,selectors:[["app-user-crud"]],standalone:!0,features:[E([w]),y],decls:13,vars:4,consts:[[1,"w-full","flex","flex-col","space-y-2"],[1,"flex","flex-col","space-y-1","mb-2",3,"formGroup"],[1,"grid","grid-cols-12","gap-2","items-center"],["for","username",1,"col-span-12","md:col-span-2"],["pInputText","","formControlName","username","name","username",1,"col-span-8","md:col-span-10","bg-gray-50","border","border-gray-300","text-gray-900","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["for","role",1,"col-span-12","md:col-span-2"],["formControlName","role","name","role","styleClass","col-span-12 md:col-span-10","appendTo","body",3,"options"],[1,"flex","justify-end","space-x-1"],["label","Save",3,"click","disabled"],["label","Cancel","styleClass","p-button-danger",3,"click","disabled"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),S(4,"Username"),s(),p(5,"input",4),s(),i(6,"div",2)(7,"label",5),S(8,"Role"),s(),p(9,"p-dropdown",6),s()(),i(10,"div",7)(11,"p-button",8),f("click",function(){return r.save()}),s(),i(12,"p-button",9),f("click",function(){return r.cancel()}),s()()()),t&2&&(n(),c("formGroup",r.userForm),n(8),c("options",r.userStore.$optionsRole()),n(2),c("disabled",r.userStore.$disabledSave()),n(),c("disabled",r.userStore.$disabledCancel()))},dependencies:[Fe,J,K,G,j,A,B,O,V,N,D]})};var re=ve.APPRAISAL_API_URL+"/user";var Q=class o{constructor(e){this.http=e}add(e){return this.http.post(re+"/add",e)}edit(e){return this.http.post(re+"/edit",e)}findByCriteriaPaginated(e){return this.http.post(re+"/findByCriteriaPaginated",e)}static \u0275fac=function(t){return new(t||o)(C(Ce))};static \u0275prov=M({token:o,factory:o.\u0275fac,providedIn:"root"})};var m=class o{constructor(e,t,r,l){this.spinnerService=e;this.userService=t;this.dialogService=r;this.messageService=l;this.init()}state={$dataList:a([]),$dataLoading:a(!1),$pagingInfo:a(new q),$totalRowCount:a(1),$selectedData:a(null),$selectedVerified:a(!0),$loading:a(!1),$disabledTable:a(!1),$optionsCategory:a([]),$selectedCategory:a(""),$searchText:a(""),$searchBtnClickEvent:a(!1),$optionsRole:a([]),$disabledUpdate:a(!0),$disabledSave:a(!0),$disabledCancel:a(!0),$formMode:a("idle")};$dataList=this.state.$dataList.asReadonly();$dataLoading=this.state.$dataLoading.asReadonly();$selectedData=this.state.$selectedData.asReadonly();$selectedVerified=$(()=>this.state.$selectedVerified());$cols=a([{field:"id",header:"ID Employee",class_td:"!text-center"},{field:"employeeFullName",header:"Name",class_td:"!text-center"},{field:"userName",header:"Username",class_td:"!text-center"},{field:"roleName",header:"Role",class_td:"!text-center"},{field:"action",header:"Actions",class_td:"flex justify-center items-center gap-2",type:"action"}]).asReadonly();$pagingInfo=this.state.$pagingInfo.asReadonly();$totalRowCount=this.state.$totalRowCount.asReadonly();$optionsCategory=this.state.$optionsCategory.asReadonly();$selectedCategory=this.state.$selectedCategory.asReadonly();$searchText=this.state.$searchText.asReadonly();$filter=$(()=>{let e=null;if(this.$selectedCategory()){e={};let t=this.$selectedCategory()??"",r;typeof e[t]=="string"?r=this.$searchText()??"":r=parseInt(this.$searchText()),e[t]=r}return e});userForm=a(new U({username:new h({value:null,disabled:!0}),role:new h({value:null,disabled:!0})})).asReadonly();$optionsRole=this.state.$optionsRole.asReadonly();$disabledUpdate=$(()=>this.state.$disabledUpdate()||this.state.$formMode()=="edit");$disabledSave=$(()=>this.state.$disabledSave()&&this.state.$formMode()=="idle");$disabledCancel=$(()=>this.state.$disabledCancel()&&this.state.$formMode()=="idle");$disabledTable=$(()=>this.state.$formMode()=="edit");$formMode=this.state.$formMode.asReadonly();ref;dialogOptions={modal:!0,styleClass:"w-11/12 md:w-5/12"};init(){this.setSpinner(),this.setSearchCategory(),this.populateList(),this.onGenerateRoleOptions()}setSpinner(){R(this.state.$loading).subscribe(e=>e?this.spinnerService.show():this.spinnerService.hide())}populateList(){this.state.$dataLoading.set(!0);let e={wrapper:this.$filter(),pagingInfo:this.state.$pagingInfo(),totalRowCount:this.state.$totalRowCount()};this.userService.findByCriteriaPaginated(e).subscribe(t=>{t.status&&(this.state.$pagingInfo.set(t.object.pagingInfo||new q),this.state.$dataList.set(t.object.dataList||[]),this.state.$totalRowCount.set(t.object.totalRowCount||0)),console.log("*** dataList USER:",this.state),this.state.$dataLoading.set(!1)})}onLazyLoad(e){this.state.$pagingInfo.set(v(_({},this.$pagingInfo()),{currentPage:Math.floor(e.first/e.rows)+1,pageSize:e.rows})),this.populateList()}onSetSelected(e){this.state.$selectedData.set(e)}patchInputCRUD(){this.userForm().patchValue({username:this.$selectedData()?.userName,role:this.$selectedData()?.roleName})}getSelectedData(){return this.state.$selectedData()}setSearchCategory(){this.state.$optionsCategory.set([{label:"Semua",value:null},{label:"Username",value:"userName"},{label:"Role",value:"roleName"},{label:"ID Employee",value:"employeeId"}])}onSearchBtnClicked({category:e,search:t}){this.state.$selectedCategory.set(e),e&&this.state.$searchText.set(t),this.populateList()}onGenerateRoleOptions(){let e=[{label:"HR",value:1},{label:"Manager",value:2},{label:"Supervisor",value:3},{label:"Staff",value:4}];this.state.$optionsRole.set(e)}resetState(){this.state.$dataList.set([]),this.state.$dataLoading.set(!1),this.state.$selectedData.set(null),this.state.$loading.set(!1),this.state.$optionsCategory.set([]),this.state.$selectedCategory.set(""),this.state.$searchText.set(""),this.state.$searchBtnClickEvent.set(!1),this.state.$optionsRole.set([]),this.userForm().reset()}setFormMode(e){this.state.$formMode.set(e)}addAction(e){this.state.$selectedData.set(e),this.state.$formMode.set("add"),this.ref=this.dialogService.open(x,v(_({},this.dialogOptions),{header:"Add User"})),this.onCloseDialogEvent()}editAction(e){this.state.$selectedData.set(e),this.state.$formMode.set("edit"),this.ref=this.dialogService.open(x,v(_({},this.dialogOptions),{header:"Edit User"})),this.onCloseDialogEvent()}onCloseDialogEvent(){this.ref?.onClose.subscribe(e=>{e&&this.populateList(),this.state.$formMode.set("idle")})}saveAction({username:e,role:t}){if(this.spinnerService.setSpinnerStyle({"z-index":"9999"}),this.state.$loading.set(!0),this.state.$formMode()=="add"&&!e)return this.messageService.add({severity:"error",summary:"Error",detail:"Username harus diisi!"}),this.state.$loading.set(!1),Z({status:!1});if(!t)return this.messageService.add({severity:"error",summary:"Error",detail:"Role harus diisi!"}),this.state.$loading.set(!1),Z({status:!1});let r=v(_({},this.state.$selectedData()),{userName:e,roleName:this.$optionsRole().find(({value:l})=>t==l)?.label,roleId:t});return this.state.$formMode()=="edit"&&(r=v(_({},this.state.$selectedData()),{roleName:this.$optionsRole().find(({value:l})=>t==l)?.label,roleId:t})),se(100).pipe(ae(()=>this.state.$formMode()!="idle"),le(()=>ie(()=>this.state.$formMode()=="edit",this.userService.edit(r),this.userService.add(r))),ce(l=>{if(l.status){let g=this.state.$formMode()=="edit"?"Edit User Berhasil!":"Simpan User Berhasil";this.messageService.add({severity:"success",summary:"Success",detail:g}),this.state.$formMode.set("idle")}else this.messageService.add({severity:"error",summary:"Error",detail:l.message});this.state.$loading.set(!1)}),ne(()=>{this.state.$loading.set(!1)}))}static \u0275fac=function(t){return new(t||o)(C(_e),C(Q),C(w),C(Se))};static \u0275prov=M({token:o,factory:o.\u0275fac})};var X=class o{userStore=u(m);category=this.userStore.$optionsCategory();selectedCategory=this.userStore.$selectedCategory();search=this.userStore.$searchText();searchForm=new U({category:new h({value:null,disabled:!1}),search:new h({value:"",disabled:!0})});tempSearch={category:null,search:""};constructor(){this.onCategoryChanges(),this.onSearchChanges()}onCategoryChanges(){this.searchForm.controls.category.valueChanges.subscribe(e=>{this.tempSearch.category=e,this.searchForm.get("search")?.reset(),e?this.searchForm.get("search")?.enable():this.searchForm.get("search")?.disable()})}onSearchChanges(){this.searchForm.controls.search.valueChanges.subscribe(e=>{this.tempSearch.search=e})}onButtonClicked(){this.userStore.onSearchBtnClicked(this.tempSearch)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=b({type:o,selectors:[["app-user-search"]],standalone:!0,features:[y],decls:5,vars:2,consts:[[1,"mb-2"],[1,"grid","grid-cols-6","grid-flow-rows","gap-2",3,"formGroup"],["styleClass","col-span-6 md:col-span-1","formControlName","category","name","category","appendTo","body",3,"options"],["pInputText","","formControlName","search","name","search",1,"col-span-5","md:col-span-4"],["icon","pi pi-search","styleClass","w-full !h-full",3,"click"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1),p(2,"p-dropdown",2)(3,"input",3),i(4,"p-button",4),f("click",function(){return r.onButtonClicked()}),s()()()),t&2&&(n(),c("formGroup",r.searchForm),n(),c("options",r.userStore.$optionsCategory()))},dependencies:[G,j,A,B,O,V,J,K,we,Ue,N,D]})};var Ne=()=>[5,10,20];function je(o,e){if(o&1&&(i(0,"th",8),S(1),s()),o&2){let t=e.$implicit;n(),te(" ",t.header," ")}}function Ae(o,e){if(o&1&&(i(0,"tr"),I(1,je,2,1,"th",7),s()),o&2){let t=e.$implicit;n(),c("ngForOf",t)}}function Be(o,e){if(o&1&&(i(0,"td"),p(1,"div",11),s()),o&2){let t=d().$implicit,r=d().$implicit;k(t.class_td),n(),c("outerHTML",t.template(r[t.field]),de)}}function Oe(o,e){if(o&1){let t=W();i(0,"td")(1,"p-button",12),f("click",function(){L(t);let l=d(2).$implicit,g=d();return T(g.userStore.addAction(l))}),s(),i(2,"p-button",13),f("click",function(){L(t);let l=d(2).$implicit,g=d();return T(g.userStore.editAction(l))}),s()()}if(o&2){let t=d().$implicit,r=d().$implicit;k(t.class_td),n(),c("disabled",r.roleId||r.username),n(),c("disabled",!r.roleId&&!r.username)}}function Ve(o,e){if(o&1&&(i(0,"td"),S(1),s()),o&2){let t=d().$implicit,r=d().$implicit;k(t.class_td),n(),te(" ",r[t.field]," ")}}function Ge(o,e){if(o&1&&I(0,Be,2,3,"td",10)(1,Oe,3,4,"td",10)(2,Ve,2,3,"td",10),o&2){let t,r=e.$implicit;me((t=r.type)==="custom"?0:t==="action"?1:2)}}function ze(o,e){if(o&1&&(i(0,"tr",9),fe(1,Ge,3,1,null,null,ue),s()),o&2){let t=e.$implicit,r=e.columns;c("pSelectableRow",t),n(),he(r)}}function He(o,e){if(o&1&&(i(0,"tr")(1,"td",14),S(2,"Data Kosong"),s()()),o&2){let t=d();n(),pe("colspan",t.userStore.$cols().length)}}var Y=class o{userStore=u(m);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=b({type:o,selectors:[["app-user-list"]],standalone:!0,features:[y],decls:11,vars:12,consts:[["dt",""],["header",""],["body",""],["emptymessage",""],[1,"card"],[3,"onLazyLoad","columns","value","loading","paginator","rows","rowsPerPageOptions","paginatorDropdownAppendTo","lazy","totalRecords"],[3,"blocked","target"],["class","!text-center",4,"ngFor","ngForOf"],[1,"!text-center"],[3,"pSelectableRow"],[3,"class"],[3,"outerHTML"],["styleClass","p-button-info","icon","pi pi-plus","pTooltip","Add user",3,"click","disabled"],["styleClass","","icon","pi pi-pencil","pTooltip","Edit user",3,"click","disabled"],[1,"!text-center","w-full"]],template:function(t,r){if(t&1){let l=W();i(0,"div",4),p(1,"app-user-search"),i(2,"p-table",5,0),f("onLazyLoad",function(Ie){return L(l),T(r.userStore.onLazyLoad(Ie))}),I(4,Ae,2,1,"ng-template",null,1,P)(6,ze,3,1,"ng-template",null,2,P)(8,He,3,1,"ng-template",null,3,P),s()(),p(10,"p-blockui",6)}if(t&2){let l=ee(3),g=ee(7);n(2),c("columns",r.userStore.$cols())("value",r.userStore.$dataList())("loading",r.userStore.$dataLoading())("paginator",!0)("rows",5)("rowsPerPageOptions",ge(11,Ne))("paginatorDropdownAppendTo",g)("lazy",!0)("totalRecords",r.userStore.$totalRowCount()),n(8),c("blocked",r.userStore.$disabledTable())("target",l)}},dependencies:[z,D,Re,xe,be,Me,$e,ye,X]})};var Te=class o{userStore=u(m);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=b({type:o,selectors:[["app-user"]],standalone:!0,features:[E([m,w,H]),y],decls:3,vars:0,consts:[[1,"w-full"],["header","User"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"p-panel",1),p(2,"app-user-list"),s()())},dependencies:[z,De,Y]})};export{Te as UserComponent};
