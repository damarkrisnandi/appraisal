import{a as n,c as A}from"./chunk-MY3DRXGK.js";import{c as k,d as y,e as j,g as M}from"./chunk-7U4M7FLE.js";import{a as R}from"./chunk-CH6NKNWW.js";import{a as T}from"./chunk-MQPYQJ3G.js";import{oa as H}from"./chunk-RKZRWIXU.js";import{B as I,I as d,J as l,O as S,W as b,Ya as g,_ as a,da as s,ea as m,v as h,w as c,z as v}from"./chunk-ZIXU4GN5.js";var u=class o{constructor(e,t,r){this.router=e;this.activatedRoute=t;this.titleService=r;this.state.$menuTree.set(n.getItem("menus")),this.setTitlePage()}state={$menuTree:g([]),$pageTitle:g("")};$menuTree=this.state.$menuTree.asReadonly();setTitlePage(){this.router.events.pipe(d(e=>e instanceof y),v(()=>this.activatedRoute),v(e=>{for(;e.firstChild;)e=e.firstChild;return e}),d(e=>e.outlet==="primary"),I(e=>e.data)).subscribe(e=>{e.pageTitle?this.titleService.setTitle(`Appraisal > ${e.pageTitle} `):this.titleService.setTitle("Appraisal")})}findInTreeBFS(e){let t=this.$menuTree();for(;t.length>0;){let r=t.shift();if(console.log(r),r&&r.routerLink===e)return r;if(r&&r.items)for(let i of r?.items||[])t.push(i)}return null}resetState(){this.state.$menuTree.set([]),this.state.$pageTitle.set(null)}static \u0275fac=function(t){return new(t||o)(s(M),s(j),s(k))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var x="tokenId",L=R.APPRAISAL_API_URL+"/auth",f=class o{constructor(e,t,r){this.userStore=e;this.menuTreeStore=t;this.http=r}isAuthenticated(){return!!this.tokenId}login(e){return this.loginService(e).pipe(b(t=>{t.status&&t.object?.jwtToken&&(this.setTokenId(t.object?.jwtToken),n.setItem("user",t.object),n.setItem("menus",this.featureToMenuItem(t.object?.role?.feature)))}))}featureToMenuItem(e){let t=[];for(let r of e){let i={};i.label=r.feature.name,i.icon=r.feature.icon,r.children&&(i.items=this.featureToMenuItem(r.children)),r.feature.accessLink&&(i.routerLink=r.feature.accessLink),t.push(i)}return t}loginService(e){return this.http.post(L+"/login",e)}forgotPassword(){}logout(){return this.logoutService().pipe(S(()=>{n.clear()}))}logoutService(){return h({})}setTokenId(e){n.setItem(x,e)}get tokenId(){return n.getItem(x)}static \u0275fac=function(t){return new(t||o)(s(A),s(u),s(T))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var _={"768px":{width:"calc(100% - 6px)",right:"3px",left:"3px"},"600px":{width:"calc(100% - 4px)",right:"2px",left:"12px"}};var te=(o,e)=>{if(n.getItem("tokenId")){let t=n.getItem("tokenId")||"";o=o.clone({headers:o.headers.set("Authorization",`Bearer ${t}`)})}return o=o.clone({headers:o.headers.set("Accept","*/*")}),e(o)};var p=class o{constructor(e){this.messageService=e}add({severity:e,summary:t,detail:r}){this.messageService.add({severity:e,summary:t,detail:r})}static \u0275fac=function(t){return new(t||o)(s(H))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var le=(o,e)=>{let t=m(f),r=m(p);return e(o).pipe(l(i=>(console.log(i),i.status===401&&(r.add({severity:"error",summary:"Error",detail:"Session Token telah habis, silahkan login kembali!"}),t.logout()),c(i))))};var he=(o,e)=>{let t=m(p);return e(o).pipe(l(r=>(console.log(r),[0,400,403,405,500].includes(r.status)&&t.add({severity:"error",summary:"Error",detail:r.error?r.error.message:r.message}),c(()=>r))))};export{u as a,f as b,te as c,le as d,he as e,_ as f};
