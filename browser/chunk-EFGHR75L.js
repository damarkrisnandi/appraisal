import{a as Pe}from"./chunk-JXHLYNK6.js";import{a as Y,b as U}from"./chunk-YDBF4JCQ.js";import{A as K,B as ke,C as Q,D as X,O as R,g as we,j as Re,o as xe,p as Fe,s as Me,u as Ie}from"./chunk-TS4LB2JZ.js";import{o as w,p as j,q,r as Ue,u as J,v as Le}from"./chunk-NDG5SCMG.js";import"./chunk-4YRY4IP2.js";import"./chunk-ATB2IEIN.js";import"./chunk-VP2SXEXU.js";import{a as F}from"./chunk-OQKDZ6KP.js";import{a as Te}from"./chunk-CH6NKNWW.js";import{b as G,e as B,f as O,g as D,h as f,k as V,l as z,p as H}from"./chunk-FLY6AGIF.js";import{b as $e}from"./chunk-NXN4P4DR.js";import{a as x}from"./chunk-QASMVVIP.js";import{qa as ve,xa as De}from"./chunk-UHXCHP4M.js";import{$b as S,Ab as ye,Bb as i,Cb as a,Db as m,G as ne,H as le,Hb as re,I as pe,Ib as u,Jb as d,O as me,Qc as Se,Sb as oe,Tb as C,U as de,Ua as ue,Vb as ie,W as ce,Xc as _e,Ya as l,Z as k,_b as N,a as _,ac as Ce,b as $,ca as b,da as g,fb as s,ha as y,nc as A,ob as P,qb as fe,ra as L,rb as p,sa as T,v as te,vb as E,wb as he,xb as ge,zb as be,zc as v}from"./chunk-QSF35MWG.js";var M=class r{userStore=g(c);ref=g(Y);userForm=new D({username:new f({value:null,disabled:!0}),role:new f({value:null,disabled:!0}),employee:new f({value:null,disabled:!0})});roleOptions=[];selectedDataSubscription;formModeSubscribtion;constructor(){this.selectedDataSubscription=x(this.userStore.$selectedData).subscribe(e=>{this.userForm.patchValue({username:this.userStore.$selectedData()?.userName,role:this.userStore.$selectedData()?.roleId})}),this.formModeSubscribtion=x(this.userStore.$formMode).subscribe(e=>{switch(e){case"add":this.userForm.get("username")?.enable(),this.userForm.get("role")?.enable();break;case"edit":this.userForm.get("username")?.disable(),this.userForm.get("role")?.enable();break;case"idle":this.userForm.get("username")?.disable(),this.userForm.get("role")?.disable();break;default:break}})}cancel(){this.ref.close()}save(){console.log(this.userForm),this.userStore.saveAction(this.userForm.value)?.subscribe(e=>{e.status&&this.ref.close()})}ngOnDestroy(){this.userForm.reset(),this.selectedDataSubscription.unsubscribe(),this.formModeSubscribtion.unsubscribe()}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=y({type:r,selectors:[["app-user-crud"]],standalone:!0,features:[N([U]),S],decls:20,vars:4,consts:[[1,"w-full","flex","flex-col","space-y-2"],[1,"flex","flex-col","space-y-1","mb-2",3,"formGroup"],[1,"grid","grid-cols-12","gap-2","items-center"],["for","username",1,"col-span-12","md:col-span-2"],["pInputText","","formControlName","username","name","username",1,"col-span-8","md:col-span-10","bg-gray-50","border","border-gray-300","text-gray-900","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["for","role",1,"col-span-12","md:col-span-2"],["formControlName","role","name","role","styleClass","col-span-12 md:col-span-10","appendTo","body",3,"options"],[1,"col-span-12","md:col-span-10"],["pInputText","","formControlName","employee","name","employee",1,"bg-gray-50","border","border-gray-300","text-gray-900","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["icon","pi pi-search",1,"h-full"],[1,"flex","justify-end","space-x-1"],["label","Save",3,"click","disabled"],["label","Cancel","styleClass","p-button-danger",3,"click","disabled"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),C(4,"Username"),a(),m(5,"input",4),a(),i(6,"div",2)(7,"label",5),C(8,"Role"),a(),m(9,"p-dropdown",6),a(),i(10,"div",2)(11,"label",3),C(12,"Employee ID"),a(),i(13,"p-inputgroup",7),m(14,"input",8),i(15,"p-inputgroup-addon"),m(16,"p-button",9),a()()()(),i(17,"div",10)(18,"p-button",11),u("click",function(){return o.save()}),a(),i(19,"p-button",12),u("click",function(){return o.cancel()}),a()()()),t&2&&(l(),p("formGroup",o.userForm),l(8),p("options",o.userStore.$optionsRole()),l(9),p("disabled",o.userStore.$disabledSave()),l(),p("disabled",o.userStore.$disabledCancel()))},dependencies:[Me,X,Q,H,G,B,O,V,z,j,w,R,q,K,J]})};var se=Te.APPRAISAL_API_URL+"/user";var Z=class r{constructor(e){this.http=e}add(e){return this.http.post(se+"/add",e)}edit(e){return this.http.post(se+"/edit",e)}findByCriteriaPaginated(e){return this.http.post(se+"/findByCriteriaPaginated",e)}static \u0275fac=function(t){return new(t||r)(b($e))};static \u0275prov=k({token:r,factory:r.\u0275fac,providedIn:"root"})};var c=class r{constructor(e,t,o,n,h){this.spinnerService=e;this.userService=t;this.dialogService=o;this.messageService=n;this.rolePermissionService=h;this.init()}state={$dataList:s([]),$dataLoading:s(!1),$pagingInfo:s(new F),$totalRowCount:s(1),$selectedData:s(null),$selectedVerified:s(!0),$loading:s(!1),$disabledTable:s(!1),$optionsCategory:s([]),$selectedCategory:s(""),$searchText:s(""),$searchBtnClickEvent:s(!1),$optionsRole:s([]),$disabledUpdate:s(!0),$disabledSave:s(!0),$disabledCancel:s(!0),$formMode:s("idle")};$dataList=this.state.$dataList.asReadonly();$dataLoading=this.state.$dataLoading.asReadonly();$selectedData=this.state.$selectedData.asReadonly();$selectedVerified=v(()=>this.state.$selectedVerified());$cols=s([{field:"id",header:"ID Employee",class_td:"!text-center"},{field:"employeeFullName",header:"Name",class_td:"!text-center"},{field:"userName",header:"Username",class_td:"!text-center"},{field:"roleName",header:"Role",class_td:"!text-center"},{field:"action",header:"Actions",class_td:"flex justify-center items-center gap-2",type:"action"}]).asReadonly();$pagingInfo=this.state.$pagingInfo.asReadonly();$totalRowCount=this.state.$totalRowCount.asReadonly();$optionsCategory=this.state.$optionsCategory.asReadonly();$selectedCategory=this.state.$selectedCategory.asReadonly();$searchText=this.state.$searchText.asReadonly();$filter=v(()=>{let e=null;if(this.$selectedCategory()){e={};let t=this.$selectedCategory()??"",o;typeof e[t]=="string"?o=this.$searchText()??"":o=parseInt(this.$searchText()),e[t]=o}return e});userForm=s(new D({username:new f({value:null,disabled:!0}),role:new f({value:null,disabled:!0})})).asReadonly();$optionsRole=this.state.$optionsRole.asReadonly();$disabledUpdate=v(()=>this.state.$disabledUpdate()||this.state.$formMode()=="edit");$disabledSave=v(()=>this.state.$disabledSave()&&this.state.$formMode()=="idle");$disabledCancel=v(()=>this.state.$disabledCancel()&&this.state.$formMode()=="idle");$disabledTable=v(()=>this.state.$formMode()=="edit");$formMode=this.state.$formMode.asReadonly();ref;dialogOptions={modal:!0,styleClass:"w-11/12 md:w-5/12"};init(){this.setSpinner(),this.setSearchCategory(),this.populateList(),this.onGenerateRoleOptions()}setSpinner(){x(this.state.$loading).subscribe(e=>e?this.spinnerService.show():this.spinnerService.hide())}populateList(){this.state.$dataLoading.set(!0);let e={wrapper:this.$filter(),pagingInfo:this.state.$pagingInfo(),totalRowCount:this.state.$totalRowCount()};this.userService.findByCriteriaPaginated(e).subscribe(t=>{t.status&&(this.state.$pagingInfo.set(t.object.pagingInfo||new F),this.state.$dataList.set(t.object.dataList||[]),this.state.$totalRowCount.set(t.object.totalRowCount||0)),this.state.$dataLoading.set(!1)})}onLazyLoad(e){this.state.$pagingInfo.set($(_({},this.$pagingInfo()),{currentPage:Math.floor(e.first/e.rows)+1,pageSize:e.rows})),this.populateList()}onSetSelected(e){this.state.$selectedData.set(e)}patchInputCRUD(){this.userForm().patchValue({username:this.$selectedData()?.userName,role:this.$selectedData()?.roleName})}getSelectedData(){return this.state.$selectedData()}setSearchCategory(){this.state.$optionsCategory.set([{label:"Semua",value:null},{label:"Username",value:"userName"},{label:"Role",value:"roleName"},{label:"ID Employee",value:"employeeId"}])}onSearchBtnClicked({category:e,search:t}){this.state.$selectedCategory.set(e),e&&this.state.$searchText.set(t),this.populateList()}onGenerateRoleOptions(){this.rolePermissionService.listRoles({pagingInfo:$(_({},new F),{retrieveAll:!0}),wrapper:{},totalRowCount:0}).subscribe(e=>{this.state.$optionsRole.set(e.object.dataList.map(t=>({label:t.name,value:t.id}))||[])})}resetState(){this.state.$dataList.set([]),this.state.$dataLoading.set(!1),this.state.$selectedData.set(null),this.state.$loading.set(!1),this.state.$optionsCategory.set([]),this.state.$selectedCategory.set(""),this.state.$searchText.set(""),this.state.$searchBtnClickEvent.set(!1),this.state.$optionsRole.set([]),this.userForm().reset()}setFormMode(e){this.state.$formMode.set(e)}addAction(e){this.state.$selectedData.set(e),this.state.$formMode.set("add"),this.ref=this.dialogService.open(M,$(_({},this.dialogOptions),{header:"Add User"})),this.onCloseDialogEvent()}editAction(e){this.state.$selectedData.set(e),this.state.$formMode.set("edit"),this.ref=this.dialogService.open(M,$(_({},this.dialogOptions),{header:"Edit User"})),this.onCloseDialogEvent()}onCloseDialogEvent(){this.ref?.onClose.subscribe(e=>{e&&this.populateList(),this.state.$formMode.set("idle")})}saveAction({username:e,role:t}){if(this.spinnerService.setSpinnerStyle({"z-index":"9999"}),this.state.$loading.set(!0),this.state.$formMode()=="add"&&!e)return this.messageService.add({severity:"error",summary:"Error",detail:"Username harus diisi!"}),this.state.$loading.set(!1),te({status:!1});if(!t)return this.messageService.add({severity:"error",summary:"Error",detail:"Role harus diisi!"}),this.state.$loading.set(!1),te({status:!1});let o=$(_({},this.state.$selectedData()),{userName:e,roleName:this.$optionsRole().find(({value:n})=>t==n)?.label,roleId:t});return this.state.$formMode()=="edit"&&(o=$(_({},this.state.$selectedData()),{roleName:this.$optionsRole().find(({value:n})=>t==n)?.label,roleId:t})),le(100).pipe(pe(()=>this.state.$formMode()!="idle"),de(()=>ne(()=>this.state.$formMode()=="edit",this.userService.edit(o),this.userService.add(o))),ce(n=>{if(n.status){let h=this.state.$formMode()=="edit"?"Edit User Berhasil!":"Simpan User Berhasil";this.messageService.add({severity:"success",summary:"Success",detail:h}),this.state.$formMode.set("idle")}else this.messageService.add({severity:"error",summary:"Error",detail:n.message});this.state.$loading.set(!1)}),me(()=>{this.state.$loading.set(!1)}))}static \u0275fac=function(t){return new(t||r)(b(De),b(Z),b(U),b(ve),b(Pe))};static \u0275prov=k({token:r,factory:r.\u0275fac})};var W=class r{userStore=g(c);category=this.userStore.$optionsCategory();selectedCategory=this.userStore.$selectedCategory();search=this.userStore.$searchText();searchForm=new D({category:new f({value:null,disabled:!1}),search:new f({value:"",disabled:!0})});tempSearch={category:null,search:""};constructor(){this.onCategoryChanges(),this.onSearchChanges()}onCategoryChanges(){this.searchForm.controls.category.valueChanges.subscribe(e=>{this.tempSearch.category=e,this.searchForm.get("search")?.reset(),e?this.searchForm.get("search")?.enable():this.searchForm.get("search")?.disable()})}onSearchChanges(){this.searchForm.controls.search.valueChanges.subscribe(e=>{this.tempSearch.search=e})}onButtonClicked(){this.userStore.onSearchBtnClicked(this.tempSearch)}onRefresh(){this.searchForm.patchValue({category:null}),this.userStore.onSearchBtnClicked(this.tempSearch)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=y({type:r,selectors:[["app-user-search"]],standalone:!0,features:[S],decls:9,vars:2,consts:[[1,"mb-2"],[1,"appraisal-search","grid","grid-cols-6","grid-flow-rows","gap-2",3,"formGroup"],["styleClass","col-span-6 md:col-span-1","formControlName","category","name","category","appendTo","body",3,"options"],[1,"col-span-6","md:col-span-4"],["pInputText","","formControlName","search","name","search"],["icon","pi pi-search","label","Search",1,"w-full","!h-full",3,"click"],["icon","pi pi-refresh","label","Reset","severity","info",1,"w-full","!h-full",3,"click"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1),m(2,"p-dropdown",2),i(3,"p-inputgroup",3),m(4,"input",4),i(5,"p-inputgroup-addon")(6,"p-button",5),u("click",function(){return o.onButtonClicked()}),a()(),i(7,"p-inputgroup-addon")(8,"p-button",6),u("click",function(){return o.onRefresh()}),a()()()()()),t&2&&(l(),p("formGroup",o.searchForm),l(),p("options",o.userStore.$optionsCategory()))},dependencies:[H,G,B,O,V,z,X,Q,Ue,q,j,w,ke,K,Le,J]})};var He=()=>[5,10,20];function qe(r,e){if(r&1&&(i(0,"th",8),C(1),a()),r&2){let t=e.$implicit;l(),ie(" ",t.header," ")}}function Ke(r,e){if(r&1&&(i(0,"tr"),P(1,qe,2,1,"th",7),a()),r&2){let t=e.$implicit;l(),p("ngForOf",t)}}function Je(r,e){if(r&1&&(i(0,"td"),m(1,"div",11),a()),r&2){let t=d().$implicit,o=d().$implicit;E(t.class_td),l(),p("outerHTML",t.template(o[t.field]),ue)}}function Qe(r,e){if(r&1){let t=re();i(0,"td")(1,"p-button",12),u("click",function(){L(t);let n=d(2).$implicit,h=d();return T(h.userStore.addAction(n))}),a(),i(2,"p-button",13),u("click",function(){L(t);let n=d(2).$implicit,h=d();return T(h.userStore.editAction(n))}),a()()}if(r&2){let t=d().$implicit,o=d().$implicit;E(t.class_td),l(),p("disabled",o.roleId||o.username),l(),p("disabled",!o.roleId&&!o.username)}}function Xe(r,e){if(r&1&&(i(0,"td"),C(1),a()),r&2){let t=d().$implicit,o=d().$implicit;E(t.class_td),l(),ie(" ",o[t.field]," ")}}function Ye(r,e){if(r&1&&P(0,Je,2,3,"td",10)(1,Qe,3,4,"td",10)(2,Xe,2,3,"td",10),r&2){let t,o=e.$implicit;he((t=o.type)==="custom"?0:t==="action"?1:2)}}function Ze(r,e){if(r&1&&(i(0,"tr",9),be(1,Ye,3,1,null,null,ge),a()),r&2){let t=e.$implicit,o=e.columns;p("pSelectableRow",t),l(),ye(o)}}function We(r,e){if(r&1&&(i(0,"tr")(1,"td",14),C(2,"Data Kosong"),a()()),r&2){let t=d();l(),fe("colspan",t.userStore.$cols().length)}}var ee=class r{userStore=g(c);static \u0275fac=function(t){return new(t||r)};static \u0275cmp=y({type:r,selectors:[["app-user-list"]],standalone:!0,features:[S],decls:11,vars:12,consts:[["dt",""],["header",""],["body",""],["emptymessage",""],[1,"card"],["showGridlines","",3,"onLazyLoad","columns","value","loading","paginator","rows","rowsPerPageOptions","paginatorDropdownAppendTo","lazy","totalRecords"],[3,"blocked","target"],["class","!text-center",4,"ngFor","ngForOf"],[1,"!text-center"],[3,"pSelectableRow"],[3,"class"],[3,"outerHTML"],["styleClass","p-button-contrast","icon","pi pi-plus","pTooltip","Add user",3,"click","disabled"],["styleClass","p-button-info","icon","pi pi-pencil","pTooltip","Edit user",3,"click","disabled"],[1,"!text-center","w-full"]],template:function(t,o){if(t&1){let n=re();i(0,"div",4),m(1,"app-user-search"),i(2,"p-table",5,0),u("onLazyLoad",function(Ae){return L(n),T(o.userStore.onLazyLoad(Ae))}),P(4,Ke,2,1,"ng-template",null,1,A)(6,Ze,3,1,"ng-template",null,2,A)(8,We,3,1,"ng-template",null,3,A),a()(),m(10,"p-blockui",6)}if(t&2){let n=oe(3),h=oe(7);l(2),p("columns",o.userStore.$cols())("value",o.userStore.$dataList())("loading",o.userStore.$dataLoading())("paginator",!0)("rows",5)("rowsPerPageOptions",Ce(11,He))("paginatorDropdownAppendTo",h)("lazy",!0)("totalRecords",o.userStore.$totalRowCount()),l(8),p("blocked",o.userStore.$disabledTable())("target",n)}},dependencies:[R,w,xe,Fe,Se,Ie,we,_e,W]})};var Ne=class r{userStore=g(c);static \u0275fac=function(t){return new(t||r)};static \u0275cmp=y({type:r,selectors:[["app-user"]],standalone:!0,features:[N([c,U,Y]),S],decls:3,vars:0,consts:[[1,"w-full"],["header","User"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"p-panel",1),m(2,"app-user-list"),a()())},dependencies:[R,Re,ee]})};export{Ne as UserComponent};
