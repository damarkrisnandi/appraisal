import{a as Pe}from"./chunk-GLYHRW3F.js";import{a as J,b as U}from"./chunk-RJMUXU55.js";import{A as Me,B as Le,C as H,D as q,E as K,g as _e,j as ve,o as Ue,p as Re,s as xe,u as Fe}from"./chunk-U6B3OBXK.js";import{m as D,n as j,o as De,p as we,s as Ie,t as Te}from"./chunk-IR44L2GU.js";import"./chunk-4YRY4IP2.js";import"./chunk-6EZYCW4Y.js";import"./chunk-MUG45JXB.js";import{a as x}from"./chunk-OQKDZ6KP.js";import{a as ke}from"./chunk-CH6NKNWW.js";import{b as A,e as B,f as G,g as w,h as g,k as O,l as V,p as z}from"./chunk-PT3WFG3U.js";import{a as Ce}from"./chunk-MQPYQJ3G.js";import{a as R}from"./chunk-6SLXRUYG.js";import{oa as Se,va as $e}from"./chunk-RKZRWIXU.js";import{m as be,t as ye}from"./chunk-O2IJJLQI.js";import{Ab as u,Bb as m,G as ie,H as se,I as ae,Kb as ee,La as ce,Lb as $,Nb as te,O as ne,Pa as l,Sb as E,Tb as C,U as le,Ub as ge,W as pe,Ya as a,_ as L,a as S,b as _,da as b,ea as h,eb as k,ec as N,gb as me,hb as p,ia as y,lb as P,mb as de,nb as ue,pb as fe,qb as he,rb as i,sa as I,sb as s,ta as T,tb as c,uc as v,v as Z,xb as W}from"./chunk-ZIXU4GN5.js";var F=class o{userStore=h(d);ref=h(J);userForm=new w({username:new g({value:null,disabled:!0}),role:new g({value:null,disabled:!0})});roleOptions=[];selectedDataSubscription;formModeSubscribtion;constructor(){this.selectedDataSubscription=R(this.userStore.$selectedData).subscribe(e=>{this.userForm.patchValue({username:this.userStore.$selectedData()?.userName,role:this.userStore.$selectedData()?.roleId})}),this.formModeSubscribtion=R(this.userStore.$formMode).subscribe(e=>{switch(e){case"add":this.userForm.get("username")?.enable(),this.userForm.get("role")?.enable();break;case"edit":this.userForm.get("username")?.disable(),this.userForm.get("role")?.enable();break;case"idle":this.userForm.get("username")?.disable(),this.userForm.get("role")?.disable();break;default:break}})}cancel(){this.ref.close()}save(){console.log(this.userForm),this.userStore.saveAction(this.userForm.value)?.subscribe(e=>{e.status&&this.ref.close()})}ngOnDestroy(){this.userForm.reset(),this.selectedDataSubscription.unsubscribe(),this.formModeSubscribtion.unsubscribe()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-user-crud"]],standalone:!0,features:[E([U]),C],decls:13,vars:4,consts:[[1,"w-full","flex","flex-col","space-y-2"],[1,"flex","flex-col","space-y-1","mb-2",3,"formGroup"],[1,"grid","grid-cols-12","gap-2","items-center"],["for","username",1,"col-span-12","md:col-span-2"],["pInputText","","formControlName","username","name","username",1,"col-span-8","md:col-span-10","bg-gray-50","border","border-gray-300","text-gray-900","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["for","role",1,"col-span-12","md:col-span-2"],["formControlName","role","name","role","styleClass","col-span-12 md:col-span-10","appendTo","body",3,"options"],[1,"flex","justify-end","space-x-1"],["label","Save",3,"click","disabled"],["label","Cancel","styleClass","p-button-danger",3,"click","disabled"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),$(4,"Username"),s(),c(5,"input",4),s(),i(6,"div",2)(7,"label",5),$(8,"Role"),s(),c(9,"p-dropdown",6),s()(),i(10,"div",7)(11,"p-button",8),u("click",function(){return r.save()}),s(),i(12,"p-button",9),u("click",function(){return r.cancel()}),s()()()),t&2&&(l(),p("formGroup",r.userForm),l(8),p("options",r.userStore.$optionsRole()),l(2),p("disabled",r.userStore.$disabledSave()),l(),p("disabled",r.userStore.$disabledCancel()))},dependencies:[xe,q,H,z,A,B,G,O,V,j,D]})};var re=ke.APPRAISAL_API_URL+"/user";var Q=class o{constructor(e){this.http=e}add(e){return this.http.post(re+"/add",e)}edit(e){return this.http.post(re+"/edit",e)}findByCriteriaPaginated(e){return this.http.post(re+"/findByCriteriaPaginated",e)}static \u0275fac=function(t){return new(t||o)(b(Ce))};static \u0275prov=L({token:o,factory:o.\u0275fac,providedIn:"root"})};var d=class o{constructor(e,t,r,n,f){this.spinnerService=e;this.userService=t;this.dialogService=r;this.messageService=n;this.rolePermissionService=f;this.init()}state={$dataList:a([]),$dataLoading:a(!1),$pagingInfo:a(new x),$totalRowCount:a(1),$selectedData:a(null),$selectedVerified:a(!0),$loading:a(!1),$disabledTable:a(!1),$optionsCategory:a([]),$selectedCategory:a(""),$searchText:a(""),$searchBtnClickEvent:a(!1),$optionsRole:a([]),$disabledUpdate:a(!0),$disabledSave:a(!0),$disabledCancel:a(!0),$formMode:a("idle")};$dataList=this.state.$dataList.asReadonly();$dataLoading=this.state.$dataLoading.asReadonly();$selectedData=this.state.$selectedData.asReadonly();$selectedVerified=v(()=>this.state.$selectedVerified());$cols=a([{field:"id",header:"ID Employee",class_td:"!text-center"},{field:"employeeFullName",header:"Name",class_td:"!text-center"},{field:"userName",header:"Username",class_td:"!text-center"},{field:"roleName",header:"Role",class_td:"!text-center"},{field:"action",header:"Actions",class_td:"flex justify-center items-center gap-2",type:"action"}]).asReadonly();$pagingInfo=this.state.$pagingInfo.asReadonly();$totalRowCount=this.state.$totalRowCount.asReadonly();$optionsCategory=this.state.$optionsCategory.asReadonly();$selectedCategory=this.state.$selectedCategory.asReadonly();$searchText=this.state.$searchText.asReadonly();$filter=v(()=>{let e=null;if(this.$selectedCategory()){e={};let t=this.$selectedCategory()??"",r;typeof e[t]=="string"?r=this.$searchText()??"":r=parseInt(this.$searchText()),e[t]=r}return e});userForm=a(new w({username:new g({value:null,disabled:!0}),role:new g({value:null,disabled:!0})})).asReadonly();$optionsRole=this.state.$optionsRole.asReadonly();$disabledUpdate=v(()=>this.state.$disabledUpdate()||this.state.$formMode()=="edit");$disabledSave=v(()=>this.state.$disabledSave()&&this.state.$formMode()=="idle");$disabledCancel=v(()=>this.state.$disabledCancel()&&this.state.$formMode()=="idle");$disabledTable=v(()=>this.state.$formMode()=="edit");$formMode=this.state.$formMode.asReadonly();ref;dialogOptions={modal:!0,styleClass:"w-11/12 md:w-5/12"};init(){this.setSpinner(),this.setSearchCategory(),this.populateList(),this.onGenerateRoleOptions()}setSpinner(){R(this.state.$loading).subscribe(e=>e?this.spinnerService.show():this.spinnerService.hide())}populateList(){this.state.$dataLoading.set(!0);let e={wrapper:this.$filter(),pagingInfo:this.state.$pagingInfo(),totalRowCount:this.state.$totalRowCount()};this.userService.findByCriteriaPaginated(e).subscribe(t=>{t.status&&(this.state.$pagingInfo.set(t.object.pagingInfo||new x),this.state.$dataList.set(t.object.dataList||[]),this.state.$totalRowCount.set(t.object.totalRowCount||0)),this.state.$dataLoading.set(!1)})}onLazyLoad(e){this.state.$pagingInfo.set(_(S({},this.$pagingInfo()),{currentPage:Math.floor(e.first/e.rows)+1,pageSize:e.rows})),this.populateList()}onSetSelected(e){this.state.$selectedData.set(e)}patchInputCRUD(){this.userForm().patchValue({username:this.$selectedData()?.userName,role:this.$selectedData()?.roleName})}getSelectedData(){return this.state.$selectedData()}setSearchCategory(){this.state.$optionsCategory.set([{label:"Semua",value:null},{label:"Username",value:"userName"},{label:"Role",value:"roleName"},{label:"ID Employee",value:"employeeId"}])}onSearchBtnClicked({category:e,search:t}){this.state.$selectedCategory.set(e),e&&this.state.$searchText.set(t),this.populateList()}onGenerateRoleOptions(){this.rolePermissionService.listRoles({pagingInfo:_(S({},new x),{retrieveAll:!0}),wrapper:{},totalRowCount:0}).subscribe(e=>{this.state.$optionsRole.set(e.object.dataList.map(t=>({label:t.name,value:t.id}))||[])})}resetState(){this.state.$dataList.set([]),this.state.$dataLoading.set(!1),this.state.$selectedData.set(null),this.state.$loading.set(!1),this.state.$optionsCategory.set([]),this.state.$selectedCategory.set(""),this.state.$searchText.set(""),this.state.$searchBtnClickEvent.set(!1),this.state.$optionsRole.set([]),this.userForm().reset()}setFormMode(e){this.state.$formMode.set(e)}addAction(e){this.state.$selectedData.set(e),this.state.$formMode.set("add"),this.ref=this.dialogService.open(F,_(S({},this.dialogOptions),{header:"Add User"})),this.onCloseDialogEvent()}editAction(e){this.state.$selectedData.set(e),this.state.$formMode.set("edit"),this.ref=this.dialogService.open(F,_(S({},this.dialogOptions),{header:"Edit User"})),this.onCloseDialogEvent()}onCloseDialogEvent(){this.ref?.onClose.subscribe(e=>{e&&this.populateList(),this.state.$formMode.set("idle")})}saveAction({username:e,role:t}){if(this.spinnerService.setSpinnerStyle({"z-index":"9999"}),this.state.$loading.set(!0),this.state.$formMode()=="add"&&!e)return this.messageService.add({severity:"error",summary:"Error",detail:"Username harus diisi!"}),this.state.$loading.set(!1),Z({status:!1});if(!t)return this.messageService.add({severity:"error",summary:"Error",detail:"Role harus diisi!"}),this.state.$loading.set(!1),Z({status:!1});let r=_(S({},this.state.$selectedData()),{userName:e,roleName:this.$optionsRole().find(({value:n})=>t==n)?.label,roleId:t});return this.state.$formMode()=="edit"&&(r=_(S({},this.state.$selectedData()),{roleName:this.$optionsRole().find(({value:n})=>t==n)?.label,roleId:t})),se(100).pipe(ae(()=>this.state.$formMode()!="idle"),le(()=>ie(()=>this.state.$formMode()=="edit",this.userService.edit(r),this.userService.add(r))),pe(n=>{if(n.status){let f=this.state.$formMode()=="edit"?"Edit User Berhasil!":"Simpan User Berhasil";this.messageService.add({severity:"success",summary:"Success",detail:f}),this.state.$formMode.set("idle")}else this.messageService.add({severity:"error",summary:"Error",detail:n.message});this.state.$loading.set(!1)}),ne(()=>{this.state.$loading.set(!1)}))}static \u0275fac=function(t){return new(t||o)(b($e),b(Q),b(U),b(Se),b(Pe))};static \u0275prov=L({token:o,factory:o.\u0275fac})};var X=class o{userStore=h(d);category=this.userStore.$optionsCategory();selectedCategory=this.userStore.$selectedCategory();search=this.userStore.$searchText();searchForm=new w({category:new g({value:null,disabled:!1}),search:new g({value:"",disabled:!0})});tempSearch={category:null,search:""};constructor(){this.onCategoryChanges(),this.onSearchChanges()}onCategoryChanges(){this.searchForm.controls.category.valueChanges.subscribe(e=>{this.tempSearch.category=e,this.searchForm.get("search")?.reset(),e?this.searchForm.get("search")?.enable():this.searchForm.get("search")?.disable()})}onSearchChanges(){this.searchForm.controls.search.valueChanges.subscribe(e=>{this.tempSearch.search=e})}onButtonClicked(){this.userStore.onSearchBtnClicked(this.tempSearch)}onRefresh(){this.searchForm.patchValue({category:null}),this.userStore.onSearchBtnClicked(this.tempSearch)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-user-search"]],standalone:!0,features:[C],decls:9,vars:2,consts:[[1,"mb-2"],[1,"grid","grid-cols-6","grid-flow-rows","gap-2",3,"formGroup"],["styleClass","col-span-6 md:col-span-1","formControlName","category","name","category","appendTo","body",3,"options"],[1,"col-span-6","md:col-span-4"],["pInputText","","formControlName","search","name","search"],["icon","pi pi-search",1,"w-full","!h-full",3,"click"],["icon","pi pi-refresh","severity","info",1,"w-full","!h-full",3,"click"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"div",1),c(2,"p-dropdown",2),i(3,"p-inputgroup",3),c(4,"input",4),i(5,"p-inputgroup-addon")(6,"p-button",5),u("click",function(){return r.onButtonClicked()}),s()(),i(7,"p-inputgroup-addon")(8,"p-button",6),u("click",function(){return r.onRefresh()}),s()()()()()),t&2&&(l(),p("formGroup",r.searchForm),l(),p("options",r.userStore.$optionsCategory()))},dependencies:[z,A,B,G,O,V,q,H,we,De,j,D,Le,Me,Te,Ie]})};var Oe=()=>[5,10,20];function Ve(o,e){if(o&1&&(i(0,"th",8),$(1),s()),o&2){let t=e.$implicit;l(),te(" ",t.header," ")}}function ze(o,e){if(o&1&&(i(0,"tr"),k(1,Ve,2,1,"th",7),s()),o&2){let t=e.$implicit;l(),p("ngForOf",t)}}function He(o,e){if(o&1&&(i(0,"td"),c(1,"div",11),s()),o&2){let t=m().$implicit,r=m().$implicit;P(t.class_td),l(),p("outerHTML",t.template(r[t.field]),ce)}}function qe(o,e){if(o&1){let t=W();i(0,"td")(1,"p-button",12),u("click",function(){I(t);let n=m(2).$implicit,f=m();return T(f.userStore.addAction(n))}),s(),i(2,"p-button",13),u("click",function(){I(t);let n=m(2).$implicit,f=m();return T(f.userStore.editAction(n))}),s()()}if(o&2){let t=m().$implicit,r=m().$implicit;P(t.class_td),l(),p("disabled",r.roleId||r.username),l(),p("disabled",!r.roleId&&!r.username)}}function Ke(o,e){if(o&1&&(i(0,"td"),$(1),s()),o&2){let t=m().$implicit,r=m().$implicit;P(t.class_td),l(),te(" ",r[t.field]," ")}}function Je(o,e){if(o&1&&k(0,He,2,3,"td",10)(1,qe,3,4,"td",10)(2,Ke,2,3,"td",10),o&2){let t,r=e.$implicit;de((t=r.type)==="custom"?0:t==="action"?1:2)}}function Qe(o,e){if(o&1&&(i(0,"tr",9),fe(1,Je,3,1,null,null,ue),s()),o&2){let t=e.$implicit,r=e.columns;p("pSelectableRow",t),l(),he(r)}}function Xe(o,e){if(o&1&&(i(0,"tr")(1,"td",14),$(2,"Data Kosong"),s()()),o&2){let t=m();l(),me("colspan",t.userStore.$cols().length)}}var Y=class o{userStore=h(d);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-user-list"]],standalone:!0,features:[C],decls:11,vars:12,consts:[["dt",""],["header",""],["body",""],["emptymessage",""],[1,"card"],["showGridlines","",3,"onLazyLoad","columns","value","loading","paginator","rows","rowsPerPageOptions","paginatorDropdownAppendTo","lazy","totalRecords"],[3,"blocked","target"],["class","!text-center",4,"ngFor","ngForOf"],[1,"!text-center"],[3,"pSelectableRow"],[3,"class"],[3,"outerHTML"],["styleClass","p-button-contrast","icon","pi pi-plus","pTooltip","Add user",3,"click","disabled"],["styleClass","p-button-info","icon","pi pi-pencil","pTooltip","Edit user",3,"click","disabled"],[1,"!text-center","w-full"]],template:function(t,r){if(t&1){let n=W();i(0,"div",4),c(1,"app-user-search"),i(2,"p-table",5,0),u("onLazyLoad",function(je){return I(n),T(r.userStore.onLazyLoad(je))}),k(4,ze,2,1,"ng-template",null,1,N)(6,Qe,3,1,"ng-template",null,2,N)(8,Xe,3,1,"ng-template",null,3,N),s()(),c(10,"p-blockui",6)}if(t&2){let n=ee(3),f=ee(7);l(2),p("columns",r.userStore.$cols())("value",r.userStore.$dataList())("loading",r.userStore.$dataLoading())("paginator",!0)("rows",5)("rowsPerPageOptions",ge(11,Oe))("paginatorDropdownAppendTo",f)("lazy",!0)("totalRecords",r.userStore.$totalRowCount()),l(8),p("blocked",r.userStore.$disabledTable())("target",n)}},dependencies:[K,D,Ue,Re,be,Fe,_e,ye,X]})};var Ne=class o{userStore=h(d);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["app-user"]],standalone:!0,features:[E([d,U,J]),C],decls:3,vars:0,consts:[[1,"w-full"],["header","User"]],template:function(t,r){t&1&&(i(0,"div",0)(1,"p-panel",1),c(2,"app-user-list"),s()())},dependencies:[K,ve,Y]})};export{Ne as UserComponent};
