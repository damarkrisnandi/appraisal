import{g as ye}from"./chunk-XNHUROM4.js";import{a as X,b as Y}from"./chunk-546AGXSP.js";import{C as Ae,D as Ie,E as b,i as we,n as G,t as Fe,u as ke,v as Me,y as Ee}from"./chunk-6XZOSR3E.js";import{l as De,m as T,o as W}from"./chunk-VTP4LYUB.js";import"./chunk-4YRY4IP2.js";import"./chunk-SPCKIS3I.js";import"./chunk-LA3WXO4F.js";import{a as le}from"./chunk-OQKDZ6KP.js";import{a as Le,c as z,f as H,g as K,h as q,i as L,k as J,l as Q}from"./chunk-4DVHWJTQ.js";import{a as Re}from"./chunk-PCSHOGMI.js";import{ka as Pe,oa as $e,sa as xe,va as Te,wa as E}from"./chunk-LU7AHZRX.js";import{$b as U,Cc as V,Fb as ae,G as ce,Gb as a,H as de,Hb as y,Hc as B,I as ue,Ib as P,Ka as ve,Nb as Se,O as fe,Oa as n,Ob as v,Pb as O,U as ge,W as he,Xa as l,Z as N,a as F,b as k,bb as S,ca as C,da as _,db as D,eb as m,ha as h,ib as M,jb as j,kb as be,lc as R,mb as _e,nb as Ce,ob as r,pb as s,qb as c,ra as x,sa as w,ub as ne,v as re,vb as u,wb as d}from"./chunk-LGYBJQJA.js";var A=class o{rolePermissionStore=_(f);ref=_(X);roleForm=new q({name:new L({value:null,disabled:!0}),notes:new L({value:null,disabled:!0})});selectedDataSubscription;formModeSubscribtion;constructor(){this.selectedDataSubscription=E(this.rolePermissionStore.roles.$selectedData).subscribe(e=>{this.roleForm.patchValue({name:this.rolePermissionStore.roles.$selectedData()?.name,notes:this.rolePermissionStore.roles.$selectedData()?.notes})}),this.formModeSubscribtion=E(this.rolePermissionStore.roles.$formMode).subscribe(e=>{switch(e){case"add":this.roleForm.enable();break;case"edit":this.roleForm.enable();break;case"idle":this.roleForm.disable();break;default:break}})}cancel(){this.rolePermissionStore.cancelAction(),this.ref.close()}save(){this.rolePermissionStore.saveAction(this.roleForm.value)?.subscribe(e=>{e.status&&this.ref.close(e)})}ngOnDestroy(){this.roleForm.reset(),this.selectedDataSubscription.unsubscribe(),this.formModeSubscribtion.unsubscribe()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["app-role-crud"]],standalone:!0,features:[v],decls:13,vars:3,consts:[[1,"w-full","flex","flex-col","space-y-2"],[1,"flex","flex-col","space-y-1","mb-2",3,"formGroup"],[1,"grid","grid-cols-12","gap-2","items-center"],["for","name",1,"col-span-12","md:col-span-2"],["pInputText","","formControlName","name","name","name",1,"col-span-8","md:col-span-10","bg-gray-50","border","border-gray-300","text-gray-900","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],["for","notes",1,"col-span-12","md:col-span-2"],["pInputText","","formControlName","notes","name","notes",1,"col-span-8","md:col-span-10","bg-gray-50","border","border-gray-300","text-gray-900","rounded-lg","focus:ring-primary-600","focus:border-primary-600","block","w-full","p-2.5","dark:bg-gray-700","dark:border-gray-600","dark:placeholder-gray-400","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500"],[1,"flex","justify-end","space-x-1"],["label","Save",3,"click","disabled"],["label","Cancel","styleClass","p-button-danger",3,"click","disabled"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",3),a(4,"Role Name"),s(),c(5,"input",4),s(),r(6,"div",2)(7,"label",5),a(8,"Note"),s(),c(9,"input",6),s()(),r(10,"div",7)(11,"p-button",8),u("click",function(){return i.save()}),s(),r(12,"p-button",9),u("click",function(){return i.cancel()}),s()()()),t&2&&(n(),m("formGroup",i.roleForm),n(10),m("disabled",i.rolePermissionStore.roles.$disabledSave()),n(),m("disabled",i.rolePermissionStore.roles.$disabledCancel()))},dependencies:[b,z,H,K,W,T,J,Q]})};var Ue=Le.APPRAISAL_API_URL,Z=Ue+"/roles",ee=class o{constructor(e){this.http=e}addRole(e){return this.http.post(Z+"/addRole",e)}editRole(e){return this.http.post(Z+"/editRole/"+e?.id,{name:e?.name,notes:e?.notes})}deleteRole(e){return this.http.delete(Z+`/delete/${e?.id??""}`)}listRoles(e){return this.http.post(Z+"/listRoles",e)}static \u0275fac=function(t){return new(t||o)(C(Re))};static \u0275prov=N({token:o,factory:o.\u0275fac,providedIn:"root"})};var f=class o{constructor(e,t,i,p,g,pe){this.spinnerService=e;this.rolePermissionService=t;this.dialogService=i;this.messageService=p;this.router=g;this.confirmationService=pe;this.init()}state={roles:{$dataList:l([]),$dataLoading:l(!1),$pagingInfo:l(new le),$totalRowCount:l(1),$selectedData:l(null),$selectedVerified:l(!0),$loading:l(!1),$disabledTable:l(!1),$optionsCategory:l([]),$selectedCategory:l(""),$searchText:l(""),$searchBtnClickEvent:l(!1),$optionsRole:l([]),$disabledUpdate:l(!0),$disabledSave:l(!0),$disabledCancel:l(!0)},permissions:{},$formMode:l("idle")};roles={$dataList:this.state.roles.$dataList.asReadonly(),$dataLoading:this.state.roles.$dataLoading.asReadonly(),$selectedData:this.state.roles.$selectedData.asReadonly(),$cols:l([{field:"no",header:"No",class_td:"!text-center !max-w-[50px]",type:"no"},{field:"name",header:"Role",class_td:"!text-center"},{field:"notes",header:"Note",class_td:"!text-center"},{field:"action",header:"Actions",class_td:"flex justify-center items-center gap-2",type:"action"}]).asReadonly(),$pagingInfo:this.state.roles.$pagingInfo.asReadonly(),$totalRowCount:this.state.roles.$totalRowCount.asReadonly(),$optionsCategory:this.state.roles.$optionsCategory.asReadonly(),$selectedCategory:this.state.roles.$selectedCategory.asReadonly(),$searchText:R(()=>this.roles.$selectedCategory()==="id"?parseInt(this.state.roles.$searchText()):this.state.roles.$searchText()),$filter:R(()=>{let e=null;return this.roles.$selectedCategory()&&(e={},e[this.roles.$selectedCategory()??""]=this.roles.$searchText()??""),e}),$optionsRole:this.state.roles.$optionsRole.asReadonly(),$disabledUpdate:R(()=>this.state.roles.$disabledUpdate()||this.state.$formMode()=="edit"),$disabledSave:R(()=>this.state.roles.$disabledSave()&&this.state.$formMode()=="idle"),$disabledCancel:R(()=>this.state.roles.$disabledCancel()&&this.state.$formMode()=="idle"),$disabledTable:R(()=>this.state.$formMode()=="edit"),$formMode:this.state.$formMode.asReadonly()};permissions={};ref;dialogOptions={modal:!0,styleClass:"w-11/12 md:w-5/12"};init(){this.setSpinner(),this.setSearchCategory(),this.populateList(),this.onGenerateRoleOptions()}setSpinner(){E(this.state.roles.$loading).subscribe(e=>e?this.spinnerService.show():this.spinnerService.hide())}populateList(){this.state.roles.$dataLoading.set(!0);let e={wrapper:this.roles.$filter(),pagingInfo:this.state.roles.$pagingInfo(),totalRowCount:this.state.roles.$totalRowCount()};this.rolePermissionService.listRoles(e).subscribe(t=>{t.status&&(this.state.roles.$pagingInfo.set(t.object.pagingInfo||new le),this.state.roles.$dataList.set(t.object.dataList||[]),this.state.roles.$totalRowCount.set(t.object.totalRowCount||0)),this.state.roles.$dataLoading.set(!1)})}onLazyLoad(e){this.state.roles.$pagingInfo.set(k(F({},this.roles.$pagingInfo()),{currentPage:Math.floor(e.first/e.rows)+1,pageSize:e.rows})),this.populateList()}onSetSelected(e){this.state.roles.$selectedData.set(e)}setSearchCategory(){this.state.roles.$optionsCategory.set([{label:"Semua",value:null},{label:"Role",value:"name"},{label:"Note",value:"notes"}])}onSearchBtnClicked({category:e,search:t}){this.state.roles.$selectedCategory.set(e),e&&this.state.roles.$searchText.set(t),this.populateList()}onGenerateRoleOptions(){let e=[{label:"HR",value:1},{label:"Manager",value:2},{label:"Supervisor",value:3},{label:"Staff",value:4}];this.state.roles.$optionsRole.set(e)}deleteAction(e){this.state.roles.$selectedData.set(e),this.confirmationService.confirm({header:"Konfirmasi",message:"Apakah Anda yakin ingin menghapus data ini?",accept:()=>{this.rolePermissionService.deleteRole(e).subscribe(t=>{if(t.status){let i=`Hapus Role [${this.roles.$selectedData()?.name}] Berhasil!`;this.messageService.add({severity:"success",summary:"Success",detail:i}),this.state.$formMode.set("idle"),this.state.roles.$selectedData.set(null)}else this.messageService.add({severity:"error",summary:"Error",detail:t.message});this.populateList()})},reject:()=>{}})}setFormMode(e){this.state.$formMode.set(e)}addAction(){this.state.$formMode.set("add"),this.ref=this.dialogService.open(A,k(F({},this.dialogOptions),{header:"Add Role"})),this.onCloseDialogEvent()}editAction(e){this.state.roles.$selectedData.set(e),this.state.$formMode.set("edit"),this.ref=this.dialogService.open(A,k(F({},this.dialogOptions),{header:"Edit Role"})),this.onCloseDialogEvent()}onCloseDialogEvent(){this.ref?.onClose.subscribe(e=>{e&&this.populateList(),this.state.$formMode.set("idle")})}saveAction({name:e,notes:t}){if(this.spinnerService.setSpinnerStyle({"z-index":"9999"}),this.state.roles.$loading.set(!0),!e)return this.messageService.add({severity:"error",summary:"Error",detail:"Nama Role harus diisi!"}),this.state.roles.$loading.set(!1),re({status:!1});if(!t)return this.messageService.add({severity:"error",summary:"Error",detail:"Note harus diisi!"}),this.state.roles.$loading.set(!1),re({status:!1});let i=k(F({},this.state.roles.$selectedData()),{name:e,notes:t});return de(100).pipe(ue(()=>this.state.$formMode()!="idle"),ge(()=>ce(()=>this.state.$formMode()=="edit",this.rolePermissionService.editRole(i),this.rolePermissionService.addRole(i))),he(p=>{if(p.status){let g=this.state.$formMode()=="edit"?"Edit Role Berhasil!":"Simpan Role Berhasil";this.messageService.add({severity:"success",summary:"Success",detail:g}),this.state.$formMode.set("idle"),this.state.roles.$selectedData.set(null)}else this.messageService.add({severity:"error",summary:"Error",detail:p.message});this.state.roles.$loading.set(!1)}),fe(()=>{this.state.roles.$loading.set(!1)}))}cancelAction(){this.state.$formMode.set("idle"),this.state.roles.$selectedData.set(null)}assignAction(e){this.state.roles.$selectedData.set(e),this.state.$formMode.set("assign")}backToRolePage(){this.state.roles.$selectedData.set(null),this.state.$formMode.set("idle")}static \u0275fac=function(t){return new(t||o)(C(Te),C(ee),C(Y),C($e),C(ye),C(Pe))};static \u0275prov=N({token:o,factory:o.\u0275fac})};var te=class o{rolePermissionStore=_(f);category=this.rolePermissionStore.roles.$optionsCategory();selectedCategory=this.rolePermissionStore.roles.$selectedCategory();search=this.rolePermissionStore.roles.$searchText();searchForm=new q({category:new L({value:null,disabled:!1}),search:new L({value:"",disabled:!0})});tempSearch={category:null,search:""};constructor(){this.onCategoryChanges(),this.onSearchChanges()}onCategoryChanges(){this.searchForm.controls.category.valueChanges.subscribe(e=>{this.tempSearch.category=e,this.searchForm.get("search")?.reset(),e?this.searchForm.get("search")?.enable():this.searchForm.get("search")?.disable()})}onSearchChanges(){this.searchForm.controls.search.valueChanges.subscribe(e=>{this.tempSearch.search=e})}onButtonClicked(){this.rolePermissionStore.onSearchBtnClicked(this.tempSearch)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["app-role-permission-search"]],standalone:!0,features:[v],decls:4,vars:2,consts:[[1,"grid","grid-cols-6","grid-flow-rows","gap-2",3,"formGroup"],["styleClass","col-span-6 md:col-span-1","formControlName","category","name","category","appendTo","body",3,"options"],["pInputText","","formControlName","search","name","search",1,"col-span-5","md:col-span-4"],["pButton","","icon","pi pi-search",1,"!h-full","p-button-primary",3,"click"]],template:function(t,i){t&1&&(r(0,"div",0),c(1,"p-select",1)(2,"input",2),r(3,"button",3),u("click",function(){return i.onButtonClicked()}),s()()),t&2&&(m("formGroup",i.searchForm),n(),m("options",i.rolePermissionStore.roles.$optionsCategory()))},dependencies:[b,z,H,K,W,Fe,De,J,Q]})};var ze=()=>[5,10,20];function He(o,e){if(o&1&&(r(0,"th",10),a(1),s()),o&2){let t=e.$implicit;n(),P(" ",t.header," ")}}function Ke(o,e){if(o&1&&(r(0,"tr"),S(1,He,2,1,"th",9),s()),o&2){let t=e.$implicit;n(),m("ngForOf",t)}}function qe(o,e){if(o&1&&(r(0,"td"),c(1,"div",13),s()),o&2){let t=d().$implicit,i=d().$implicit;M(t.class_td),n(),m("outerHTML",t.template(i[t.field]),ve)}}function Je(o,e){if(o&1){let t=ne();r(0,"td")(1,"p-button",14),u("click",function(){x(t);let p=d(2).$implicit,g=d();return w(g.rolePermissionStore.deleteAction(p))}),s(),r(2,"p-button",15),u("click",function(){x(t);let p=d(2).$implicit,g=d();return w(g.rolePermissionStore.editAction(p))}),s(),r(3,"p-button",16),u("click",function(){x(t);let p=d(2).$implicit,g=d();return w(g.rolePermissionStore.assignAction(p))}),s()()}if(o&2){let t=d().$implicit;M(t.class_td)}}function Qe(o,e){if(o&1&&(r(0,"td"),a(1),s()),o&2){let t=d().$implicit,i=d().rowIndex;M(t.class_td),n(),P(" ",i+1," ")}}function We(o,e){if(o&1&&(r(0,"td"),a(1),s()),o&2){let t=d().$implicit,i=d().$implicit;M(t.class_td),n(),P(" ",i[t.field]," ")}}function Xe(o,e){if(o&1&&S(0,qe,2,3,"td",12)(1,Je,4,2,"td",12)(2,Qe,2,3,"td",12)(3,We,2,3,"td",12),o&2){let t,i=e.$implicit;j((t=i.type)==="custom"?0:t==="action"?1:t==="no"?2:3)}}function Ye(o,e){if(o&1&&(r(0,"tr",11),_e(1,Xe,4,1,null,null,be),s()),o&2){let t=e.$implicit,i=e.columns;m("pSelectableRow",t),n(),Ce(i)}}function Ze(o,e){if(o&1&&(r(0,"tr")(1,"td",17),a(2,"Data Kosong"),s()()),o&2){let t=d();n(),D("colspan",t.rolePermissionStore.roles.$cols().length)}}var oe=class o{rolePermissionStore=_(f);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["app-role-permission-list"]],standalone:!0,features:[v],decls:13,vars:12,consts:[["dt",""],["header",""],["body",""],["emptymessage",""],[1,"card"],[1,"flex","justify-end","items-center","gap-1","flex-col","md:flex-row","mb-2"],["styleClass","p-button-contrast w-full","icon","pi pi-plus","label","Tambah Role",3,"click"],[3,"onLazyLoad","columns","value","loading","paginator","rows","rowsPerPageOptions","paginatorDropdownAppendTo","lazy","totalRecords"],[3,"blocked","target"],["class","!text-center",4,"ngFor","ngForOf"],[1,"!text-center"],[3,"pSelectableRow"],[3,"class"],[3,"outerHTML"],["styleClass","p-button-danger","icon","pi pi-trash","pTooltip","Hapus Role",3,"click"],["styleClass","p-button-info","icon","pi pi-pencil","pTooltip","Ubah Role",3,"click"],["styleClass","","icon","pi pi-list-check","pTooltip","Assign Permissions",3,"click"],[1,"!text-center","w-full"]],template:function(t,i){if(t&1){let p=ne();r(0,"div",4)(1,"div",5)(2,"p-button",6),u("click",function(){return x(p),w(i.rolePermissionStore.addAction())}),s(),c(3,"app-role-permission-search"),s(),r(4,"p-table",7,0),u("onLazyLoad",function(pe){return x(p),w(i.rolePermissionStore.onLazyLoad(pe))}),S(6,Ke,2,1,"ng-template",null,1,U)(8,Ye,3,1,"ng-template",null,2,U)(10,Ze,3,1,"ng-template",null,3,U),s()(),c(12,"p-blockui",8)}if(t&2){let p=ae(5),g=ae(9);n(4),m("columns",i.rolePermissionStore.roles.$cols())("value",i.rolePermissionStore.roles.$dataList())("loading",i.rolePermissionStore.roles.$dataLoading())("paginator",!0)("rows",5)("rowsPerPageOptions",O(11,ze))("paginatorDropdownAppendTo",g)("lazy",!0)("totalRecords",i.rolePermissionStore.roles.$totalRowCount()),n(8),m("blocked",i.rolePermissionStore.roles.$disabledTable())("target",p)}},dependencies:[B,V,b,T,ke,Me,Ee,we,te]})};function et(o,e){if(o&1&&(r(0,"th",3),a(1),s()),o&2){let t=e.$implicit;n(),P(" ",t.header," ")}}function tt(o,e){if(o&1&&(r(0,"tr")(1,"th",3),a(2,"Name"),s(),r(3,"th",3),a(4,"Feature Assign"),s(),r(5,"th",3),a(6,"Permission Assign"),s()(),r(7,"tr"),S(8,et,2,1,"th",4),s()),o&2){let t=e.$implicit;n(),D("rowspan",2),n(2),D("rowspan",2),n(2),D("colspan",6),n(3),m("ngForOf",t)}}function ot(o,e){if(o&1&&(r(0,"tr")(1,"td"),c(2,"p-treeTableToggler",5),a(3),s(),r(4,"td"),a(5),s(),r(6,"td",3),a(7),s(),r(8,"td",3),a(9),s(),r(10,"td",3),a(11),s(),r(12,"td",3),a(13),s(),r(14,"td",3),a(15),s(),r(16,"td",3),a(17),s()()),o&2){let t=e.$implicit,i=e.rowData;n(2),m("rowNode",t),n(),P(" ",i.feature," "),n(2),y(i.featureAssign),n(2),y(i.list),n(2),y(i.view),n(2),y(i.add),n(2),y(i.update),n(2),y(i.delete),n(2),y(i.print)}}var ie=class o{products;cols;constructor(){this.cols=[{field:"list",header:"List"},{field:"view",header:"View"},{field:"add",header:"Add"},{field:"update",header:"Update"},{field:"delete",header:"Delete"},{field:"print",header:"Print"}],this.products=[{data:{feature:"Laptop",featureAssign:"v",list:"v",view:"v",add:"v",update:"v",delete:"v",print:"v"},children:[{data:{feature:"Accessories",featureAssign:"v",list:"v",view:"v",add:"v",update:"v",delete:"v",print:"v"}},{data:{feature:"Insurance",featureAssign:"v",list:"v",view:"v",add:"v",update:"v",delete:"v",print:"v"}}],expanded:!0},{data:{feature:"Phone",featureAssign:"v",list:"v",view:"v",add:"v",update:"v",delete:"v",print:"v"},children:[{data:{feature:"Headset",featureAssign:"v",list:"v",view:"v",add:"v",update:"v",delete:"v",print:"v"}}],expanded:!0}]}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["app-role-assign-permission-list"]],standalone:!0,features:[v],decls:3,vars:2,consts:[["showGridlines","",3,"value","columns"],["pTemplate","header"],["pTemplate","body"],[1,"!text-center"],["class","!text-center",4,"ngFor","ngForOf"],[3,"rowNode"]],template:function(t,i){t&1&&(r(0,"p-treeTable",0),S(1,tt,9,4,"ng-template",1)(2,ot,18,9,"ng-template",2),s()),t&2&&m("value",i.products)("columns",i.cols)},dependencies:[b,xe,V,Ae,Ie]})};var se=class o{rolePermissionStore=_(f);$header=R(()=>`${this.rolePermissionStore.roles.$selectedData()?.name} - ${this.rolePermissionStore.roles.$selectedData()?.notes}`);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["app-role-assign-permission"]],standalone:!0,features:[v],decls:5,vars:1,consts:[[1,"w-full"],[3,"header"],[1,"flex","items-center","justify-end"],["label","Kembali","icon","pi pi-sign-out","severity","danger",3,"click"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"p-panel",1),c(2,"app-role-assign-permission-list"),r(3,"div",2)(4,"p-button",3),u("click",function(){return i.rolePermissionStore.backToRolePage()}),s()()()()),t&2&&(n(),m("header",i.$header()||"-"))},dependencies:[B,b,G,T,ie]})};var st=()=>["idle","add","edit"];function rt(o,e){o&1&&(r(0,"div",0)(1,"p-panel",1),c(2,"app-role-permission-list"),s()())}function nt(o,e){o&1&&c(0,"app-role-assign-permission")}var Ne=class o{rolePermissionStore=_(f);static \u0275fac=function(t){return new(t||o)};static \u0275cmp=h({type:o,selectors:[["app-role-permission"]],standalone:!0,features:[Se([f,X,Y]),v],decls:2,vars:2,consts:[[1,"w-full"],["header","Roles List"]],template:function(t,i){t&1&&S(0,rt,3,0,"div",0)(1,nt,1,0,"app-role-assign-permission"),t&2&&j(O(1,st).includes(i.rolePermissionStore.roles.$formMode())?0:1)},dependencies:[b,G,oe,se]})};export{Ne as RolePermissionComponent};
