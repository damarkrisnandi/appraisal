import{a as i,c as A}from"./chunk-43HQCLBA.js";import{c as y,d as k,e as j,g as H}from"./chunk-REFMHAKZ.js";import{a as R}from"./chunk-CXEROHL4.js";import{a as T}from"./chunk-XYMFY6KF.js";import{oa as M}from"./chunk-GJCIPXRX.js";import{B as I,I as d,J as f,O as S,W as b,Xa as g,Z as a,ca as n,da as m,v as h,w as c,z as v}from"./chunk-5OT5OU7P.js";var l=class r{constructor(e,t,o){this.router=e;this.activatedRoute=t;this.titleService=o;this.state.$menuTree.set(i.getItem("menus")),this.setTitlePage()}state={$menuTree:g([]),$pageTitle:g("")};$menuTree=this.state.$menuTree.asReadonly();setTitlePage(){this.router.events.pipe(d(e=>e instanceof k),v(()=>this.activatedRoute),v(e=>{for(;e.firstChild;)e=e.firstChild;return e}),d(e=>e.outlet==="primary"),I(e=>e.data)).subscribe(e=>{e.pageTitle?this.titleService.setTitle(`Appraisal > ${e.pageTitle} `):this.titleService.setTitle("Appraisal")})}resetState(){this.state.$menuTree.set([]),this.state.$pageTitle.set(null)}static \u0275fac=function(t){return new(t||r)(n(H),n(j),n(y))};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};var $="tokenId",L=R.APPRAISAL_API_URL+"/auth",u=class r{constructor(e,t,o){this.userStore=e;this.menuTreeStore=t;this.http=o}isAuthenticated(){return!!this.tokenId}login(e){return this.loginService(e).pipe(b(t=>{t.status&&t.object?.jwtToken&&(this.setTokenId(t.object?.jwtToken),i.setItem("user",t.object),i.setItem("menus",this.featureToMenuItem(t.object?.role?.feature)))}))}featureToMenuItem(e){let t=[];for(let o of e){let s={};s.label=o.feature.name,s.icon=o.feature.icon,o.children&&(s.items=this.featureToMenuItem(o.children)),o.feature.accessLink&&(s.routerLink=o.feature.accessLink),t.push(s)}return t}loginService(e){return this.http.post(L+"/login",e)}forgotPassword(){}logout(){return this.logoutService().pipe(S(()=>{i.clear()}))}logoutService(){return h({})}setTokenId(e){i.setItem($,e)}get tokenId(){return i.getItem($)}static \u0275fac=function(t){return new(t||r)(n(A),n(l),n(T))};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};var _={"768px":{width:"calc(100% - 6px)",right:"3px",left:"3px"},"600px":{width:"calc(100% - 4px)",right:"2px",left:"12px"}};var te=(r,e)=>{if(i.getItem("tokenId")){let t=i.getItem("tokenId")||"";r=r.clone({headers:r.headers.set("Authorization",`Bearer ${t}`)})}return r=r.clone({headers:r.headers.set("Accept","*/*")}),e(r)};var p=class r{constructor(e){this.messageService=e}add({severity:e,summary:t,detail:o}){this.messageService.add({severity:e,summary:t,detail:o})}static \u0275fac=function(t){return new(t||r)(n(M))};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})};var fe=(r,e)=>{let t=m(u),o=m(p);return e(r).pipe(f(s=>(console.log(s),s.status===401&&(o.add({severity:"error",summary:"Error",detail:"Session Token telah habis, silahkan login kembali!"}),t.logout()),c(s))))};var he=(r,e)=>{let t=m(p);return e(r).pipe(f(o=>(console.log(o),[403,500].includes(o.status)&&t.add({severity:"error",summary:"Error",detail:o.error?o.error.message:o.message}),c(()=>o))))};export{l as a,u as b,te as c,fe as d,he as e,_ as f};
