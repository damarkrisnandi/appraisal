import{a as n,c as A}from"./chunk-6YQ7WXOM.js";import{a as R}from"./chunk-CH6NKNWW.js";import{b as T,h as k,j as y,k as j,m as M}from"./chunk-NXN4P4DR.js";import{qa as H}from"./chunk-UHXCHP4M.js";import{B as I,I as g,J as l,O as S,W as b,Z as a,ca as s,da as p,fb as v,v as h,w as c,z as d}from"./chunk-QSF35MWG.js";var u=class o{constructor(e,r,t){this.router=e;this.activatedRoute=r;this.titleService=t;this.state.$menuTree.set(n.getItem("menus")),this.setTitlePage()}state={$menuTree:v([]),$pageTitle:v("")};$menuTree=this.state.$menuTree.asReadonly();setTitlePage(){this.router.events.pipe(g(e=>e instanceof y),d(()=>this.activatedRoute),d(e=>{for(;e.firstChild;)e=e.firstChild;return e}),g(e=>e.outlet==="primary"),I(e=>e.data)).subscribe(e=>{e.pageTitle?this.titleService.setTitle(`Appraisal > ${e.pageTitle} `):this.titleService.setTitle("Appraisal")})}findInTreeBFS(e){let r=this.$menuTree();for(;r.length>0;){let t=r.shift();if(console.log(t),t&&t.routerLink===e)return t;if(t&&t.items)for(let i of t?.items||[])r.push(i)}return null}resetState(){this.state.$menuTree.set([]),this.state.$pageTitle.set(null)}static \u0275fac=function(r){return new(r||o)(s(M),s(j),s(k))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var x="tokenId",L=R.APPRAISAL_API_URL+"/auth",f=class o{constructor(e,r,t){this.userStore=e;this.menuTreeStore=r;this.http=t}isAuthenticated(){return!!this.tokenId}login(e){return this.loginService(e).pipe(b(r=>{r.status&&r.object?.jwtToken&&(this.setTokenId(r.object?.jwtToken),n.setItem("user",r.object),n.setItem("menus",this.featureToMenuItem(r.object?.role?.feature)))}))}featureToMenuItem(e){let r=[];for(let t of e){let i={};i.label=t.feature.name,i.icon=t.feature.icon,t.children&&(i.items=this.featureToMenuItem(t.children)),t.feature.accessLink&&(i.routerLink=t.feature.accessLink),r.push(i)}return r}loginService(e){return this.http.post(L+"/login",e)}forgotPassword(){}logout(){return this.logoutService().pipe(S(()=>{n.clear()}))}logoutService(){return h({})}setTokenId(e){n.setItem(x,e)}get tokenId(){return n.getItem(x)}static \u0275fac=function(r){return new(r||o)(s(A),s(u),s(T))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var _={"768px":{width:"calc(100% - 6px)",right:"3px",left:"3px"},"600px":{width:"calc(100% - 4px)",right:"2px",left:"12px"}};var te=(o,e)=>{if(n.getItem("tokenId")){let r=n.getItem("tokenId")||"";o=o.clone({headers:o.headers.set("Authorization",`Bearer ${r}`)})}return o=o.clone({headers:o.headers.set("Accept","*/*")}),e(o)};var m=class o{constructor(e){this.messageService=e}add({severity:e,summary:r,detail:t}){this.messageService.add({severity:e,summary:r,detail:t})}static \u0275fac=function(r){return new(r||o)(s(H))};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var le=(o,e)=>{let r=p(f),t=p(m);return e(o).pipe(l(i=>(console.log(i),i.status===401&&(t.add({severity:"error",summary:"Error",detail:"Session Token telah habis, silahkan login kembali!"}),r.logout()),c(i))))};var he=(o,e)=>{let r=p(m);return e(o).pipe(l(t=>(console.log(t),[0,400,403,405,500].includes(t.status)&&r.add({severity:"error",summary:"Error",detail:t.error&&(t.error.message||t.error.detail)?t.error.message||t.error.detail:t.message}),c(()=>t))))};export{u as a,f as b,te as c,le as d,he as e,_ as f};
